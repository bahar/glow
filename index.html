<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="media/screen.css">
    <title>Firefox 4 Download Stats</title>
    <link rel="shortcut icon" type="image/x-icon" href="media/favicon.ico">
    <style>
      #map polygon {
          fill: url(#glow);
      }
    </style>
  </head>
  <body>
    <div id="bigcounter" class="glow stowed">
    </div>
    <div id="app">
      <section id="ui">
        <div class="menu glow"></div>
        <div class="bars glow"></div>
        <div class="masthead glow">
          <div id="wordmark">
            <h2>mozilla</h2>
            <h1>Firefox<small>&reg;</small><b>4</b></h1>
          </div>
        </div>
        <div class="cta">
        </div>
      </section>
      <section id="geo" dir="ltr">
        <div id="map_container">
          <div id="map">
            <div id="mapdata"></div>
          </div>
          <canvas id="pings" width="3600" height="1800"></canvas>
          <div id="controls">
            <a id="out"></a>
          </div>
        </div>
      </section>
    </div>
    <div id="callout">
    </div>
    <canvas id="c"></canvas>
    <svg>
      <defs>
        <radialGradient gradientUnits="userSpaceOnUse" id="glow" fx="50%" fy="0" cx="1800" cy="0" r="1800">
          <stop offset="0%" style="stop-color:#23497a; stop-opacity:1"></stop>
          <stop offset="78%" style="stop-color:#011841; stop-opacity:1"></stop>
        </radialGradient>
      </defs>
    </svg>
    <script src="media/jquery.js"></script>
    <script src="media/vast.js"></script>
    <script src="media/map.js"></script>
    <script src="media/bars.js"></script>
    <script src="media/counter.js"></script>
    <script src="dynamo/"></script>
    <script>
      $.getScript("locale/" + glow.locale + "/l10n.js", function() {
        document.title = gettext("Firefox 4 Download Stats");
        $('html').addClass(glow.dir)
          .attr({lang: glow.locale.replace('_', '-'), dir: glow.dir});
      });

      var $out = $("#out"),
          $mc = $("#map_container"),
          $map = $("#map");

      glow.view = "map";
      glow.map= {};
      glow.data = {
        bars: {},
        map: {},
        sector: {},
        counter: {}
      };

      $(function() {
        initCounter();
        initBars();
        initMap();
        loadMap();
      });

      function loadMap() {
        $.get("./maps/world_4.svg", function(resp) {
          if (vast.capabilities.inlineSVG) {
            $("#mapdata").empty().html(resp);
          } else {
            $("#mapdata").empty().append('<img width="3600" height"1800" src="maps/world_4.png">');
          }
          $("#mapdata").css({
            "-moz-transform": "scale(" + $mc.width()/3600 + ")",
            "-webkit-transform-origin": "0 0",
            "-webkit-transform": "scale(" + $mc.width()/3600 + ")",
            "-o-transform-origin": "0 0",
            "-o-transform": "scale(" + $mc.width()/3600 + ")"
          });
          initData();
        }, "text");
      }

      function processData(type) {
        return function(r) {
          glow.data[type].next = r;
        };
      }

      function initData() {
        $.getJSON("data/json/" + glow.time + "/map.json", function(r) {
          processData("map")(r);
          glow.map.playNext();
        });
        $.getJSON("data/json/" + glow.time + "/count.json", function(r) {
          processData("counter")(r);
          glow.counter.playNext();
        });
      }
      $(function() {
        var launchDate = (new Date(2011,2,15,10,0)).getTime(),
            diff, soon, os,
            l,s,m,h,d,n,n2,
            $el = $("#bigcounter");
      });
    </script>
  </body>
</html>
